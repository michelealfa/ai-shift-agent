services:
  # 1. Unified App (API + Worker) - Fits in Free Tier
  - type: web
    name: shift-agent-app
    region: frankfurt
    plan: free
    env: docker
    dockerContext: .
    dockerfilePath: docker/Dockerfile.combined
    envVars:
      - key: DATABASE_URL
        fromDatabase:
          name: shift-agent-db
          property: connectionString
      - key: REDIS_URL
        fromService:
          type: keyvalue
          name: shift-agent-redis
          property: connectionString
      - fromGroup: shift-agent-secrets

  # 2. Redis (KeyValue store)
  - type: keyvalue
    name: shift-agent-redis
    region: frankfurt
    plan: free
    ipAllowList: [] # Internal access only

# 3. Managed Database
databases:
  - name: shift-agent-db
    region: frankfurt
    plan: free

# 4. Shared Secrets Group
envVarGroups:
  - name: shift-agent-secrets
    envVars:
      - key: GEMINI_API_KEY
        sync: false
      - key: TELEGRAM_BOT_TOKEN
        sync: false
      - key: TELEGRAM_WEBHOOK_URL
        sync: false
      - key: GOOGLE_MAPS_API_KEY
        sync: false
      - key: X_API_KEY
        sync: false
      - key: TARGET_USER_NAME
        value: CARLO
